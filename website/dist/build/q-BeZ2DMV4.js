import{a,s as c,t as n,q as o}from"./q-dgQLQ9M1.js";import{u as i}from"./q-CyNgVds-.js";import{L as s}from"./q-BuauhHiJ.js";const h=[{text:"The problem",id:"the-problem",level:2},{text:"The solution",id:"the-solution",level:2},{text:"The impact",id:"the-impact",level:2},{text:"Let's discuss",id:"lets-discuss",level:2}],u={title:"Should we change the object schema?",meta:[{name:"description",content:"Great news! Valibot v1 RC is just around the corner. There are only a few  issues holding us back."}],styles:[],links:[],scripts:[],frontmatter:{cover:"API Design",published:"2025-01-18",authors:["fabian-hiller","andersk","EltonLobo07"]}},k={cover:"API Design",title:"Should we change the object schema?",description:"Great news! Valibot v1 RC is just around the corner. There are only a few  issues holding us back.",published:"2025-01-18",authors:["fabian-hiller","andersk","EltonLobo07"]};function l(t){const e={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",span:"span",...i(),...t.components};return n(o,{children:[n(e.p,{children:["Great news! Valibot v1 RC is just around the corner. There are only a few issues holding us back. One of them is ",n(e.a,{href:"https://github.com/fabian-hiller/valibot/issues/983",rel:"noreferrer",target:"_blank",children:"issue #983"}),", which may lead to a breaking change. That's why I want to discuss this with you before making a final decision. This blog post will explain the current situation and the reasons for the proposed changes."]}),`
`,n(e.h2,{id:"the-problem",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#the-problem",children:n(e.span,{class:"icon icon-link"})}),"The problem"]}),`
`,n(e.p,{children:["Currently, Valibot does not distinguish between missing and undefined object entries. This leads to a mismatch between the input and output values of a schema and their types when TypeScript's ",n(e.a,{href:"https://www.typescriptlang.org/tsconfig/#exactOptionalPropertyTypes",rel:"noreferrer",target:"_blank",children:[n(e.code,{children:"exactOptionalPropertyTypes"})," configuration"]})," is enabled."]}),`
`,n(e.pre,{class:"language-ts",children:n(e.code,{class:"language-ts",children:[n(e.span,{class:"token keyword module",children:"import"})," ",n(e.span,{class:"token imports",children:[n(e.span,{class:"token operator",children:"*"})," ",n(e.span,{class:"token keyword module",children:"as"})," v"]})," ",n(e.span,{class:"token keyword module",children:"from"})," ",n(e.span,{class:"token string",children:"'valibot'"}),n(e.span,{class:"token punctuation",children:";"}),`

`,n(e.span,{class:"token comment",children:"// This throws no error and types `output` as `{ key?: string }`"}),`
`,n(e.span,{class:"token keyword",children:"const"})," ",n(e.span,{class:"token maybe-class-name",children:"Schema"})," ",n(e.span,{class:"token operator",children:"="})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"object"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:"{"})," key",n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"optional"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:")"})," ",n(e.span,{class:"token punctuation",children:"}"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:";"}),`
`,n(e.span,{class:"token keyword",children:"const"})," output ",n(e.span,{class:"token operator",children:"="})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"parse"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token maybe-class-name",children:"Schema"}),n(e.span,{class:"token punctuation",children:","})," ",n(e.span,{class:"token punctuation",children:"{"})," key",n(e.span,{class:"token operator",children:":"})," ",n(e.span,{class:"token keyword nil",children:"undefined"})," ",n(e.span,{class:"token punctuation",children:"}"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:";"}),`

`,n(e.span,{class:"token comment",children:"// TypeScript thinks that `key` is a string if it is present"}),`
`,n(e.span,{class:"token comment",children:"// but this is wrong because `key` is actually `undefined`"}),`
`,n(e.span,{class:"token keyword control-flow",children:"if"})," ",n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token string",children:"'key'"})," ",n(e.span,{class:"token keyword",children:"in"})," output",n(e.span,{class:"token punctuation",children:")"})," ",n(e.span,{class:"token punctuation",children:"{"}),`
  `,n(e.span,{class:"token keyword",children:"const"})," key ",n(e.span,{class:"token operator",children:"="})," output",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token property-access",children:"key"}),n(e.span,{class:"token punctuation",children:";"}),`
`,n(e.span,{class:"token punctuation",children:"}"}),`
`]})}),`
`,n(e.h2,{id:"the-solution",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#the-solution",children:n(e.span,{class:"icon icon-link"})}),"The solution"]}),`
`,n(e.p,{children:["The solution to this mismatch is to finalize ",n(e.a,{href:"https://github.com/fabian-hiller/valibot/pull/1013",rel:"noreferrer",target:"_blank",children:"PR #1013"})," and change the implementation of ",n(s,{href:"/api/object/",children:n(e.code,{children:"object"})})," and ",n(s,{href:"/api/optional/",children:n(e.code,{children:"optional"})})," to distinguish between missing and undefined object entries. To allow missing entries, ",n(s,{href:"/api/optional/",children:n(e.code,{children:"optional"})})," must be used as the outermost schema of an object entry. To explicitly allow ",n(e.code,{children:"undefined"})," as a value, another schema function called ",n(s,{href:"/api/undefinedable/",children:n(e.code,{children:"undefinedable"})})," must be used."]}),`
`,`
`,n(e.pre,{class:"language-ts",children:n(e.code,{class:"language-ts",children:[n(e.span,{class:"token keyword",children:"const"})," ",n(e.span,{class:"token maybe-class-name",children:"Schema"})," ",n(e.span,{class:"token operator",children:"="})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"object"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:"{"}),`
  key1`,n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),"                               ",n(e.span,{class:"token comment",children:"// key1: string"}),`
  key2`,n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"optional"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),"                   ",n(e.span,{class:"token comment",children:"// key2?: string"}),`
  key3`,n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"undefinedable"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),"              ",n(e.span,{class:"token comment",children:"// key3: string | undefined"}),`
  key4`,n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"optional"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"undefinedable"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),"  ",n(e.span,{class:"token comment",children:"// key4?: string | undefined"}),`
`,n(e.span,{class:"token punctuation",children:"}"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:";"}),`
`]})}),`
`,n(e.h2,{id:"the-impact",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#the-impact",children:n(e.span,{class:"icon icon-link"})}),"The impact"]}),`
`,n(e.p,{children:"As seen in the previous code example, defining an object entry that can be both missing and undefined gets a little verbose. This gets especially ugly if you define a default value for both cases."}),`
`,n(e.pre,{class:"language-ts",children:n(e.code,{class:"language-ts",children:[n(e.span,{class:"token keyword",children:"const"})," ",n(e.span,{class:"token maybe-class-name",children:"Schema"})," ",n(e.span,{class:"token operator",children:"="})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"object"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:"{"}),`
  key`,n(e.span,{class:"token operator",children:":"})," v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"optional"}),n(e.span,{class:"token punctuation",children:"("}),`
    v`,n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"undefinedable"}),n(e.span,{class:"token punctuation",children:"("}),"v",n(e.span,{class:"token punctuation",children:"."}),n(e.span,{class:"token method function property-access",children:"string"}),n(e.span,{class:"token punctuation",children:"("}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","})," ",n(e.span,{class:"token string",children:"'undefinedable_default'"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),`
    `,n(e.span,{class:"token string",children:"'optional_default'"}),`
  `,n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:","}),`
`,n(e.span,{class:"token punctuation",children:"}"}),n(e.span,{class:"token punctuation",children:")"}),n(e.span,{class:"token punctuation",children:";"}),`
`]})}),`
`,n(e.p,{children:["To fix this, we could add a new function that covers both. The problem is that there is a third schema function called ",n(s,{href:"/api/nullable/",children:n(e.code,{children:"nullable"})})," that also allows ",n(e.code,{children:"null"})," values. So adding a new function to cover every possible combination of ",n(s,{href:"/api/optional/",children:n(e.code,{children:"optional"})}),", ",n(s,{href:"/api/undefinedable/",children:n(e.code,{children:"undefinedable"})})," and ",n(s,{href:"/api/nullable/",children:n(e.code,{children:"nullable"})})," would result in 7 functions in total. I doubt this will make the API any better."]}),`
`,n(e.h2,{id:"lets-discuss",children:[n(e.a,{"aria-hidden":"true",tabindex:"-1",href:"#lets-discuss",children:n(e.span,{class:"icon icon-link"})}),"Let's discuss"]}),`
`,n(e.p,{children:["What do you think? Should we distinguish between missing and undefined object entries and fully support TypeScript's ",n(e.code,{children:"exactOptionalPropertyTypes"})," configuration? If so, should we remove ",n(s,{href:"/api/nullish/",children:n(e.code,{children:"nullish"})})," and only provide 3 strong primitives with ",n(s,{href:"/api/optional/",children:n(e.code,{children:"optional"})}),", ",n(s,{href:"/api/undefinedable/",children:n(e.code,{children:"undefinedable"})})," and ",n(s,{href:"/api/nullable/",children:n(e.code,{children:"nullable"})}),"? Or should we add 4 more functions to cover all possible combinations? If so, what names would you use?"]}),`
`,n(e.p,{children:[`Your opinion matters to me. I encourage everyone to share their thoughts. Even quick feedback like "I like this ... and I don't like that ..." is welcome and will help to shape Valibot's future API design. Please discuss with us on `,n(e.a,{href:"https://github.com/fabian-hiller/valibot/discussions/1022",rel:"noreferrer",target:"_blank",children:"GitHub"})," or share your thoughts on social media."]})]})}const f=(t={})=>{const e=a(c,{children:a(l,t,3,null)},3,"jaCj93_e");return typeof MDXLayout=="function"?n(MDXLayout,{children:e}):e};export{f as default,k as frontmatter,u as head,h as headings};
